{% extends "leden/base.html" %}
{% load base %}

{% block head %}
{{ block.super }}
<script type="text/javascript">
$(function(){
        $.defaultText();
});

close_event = function() {
        $.getJSON("{% url api %}", {
                        'action': 'close-event',
                        'id': '{{ object.id }}' },
                        function(d) {
                if(d.success) window.location.reload();
                if(d.error) alert(d.error);
        });
};

change_debit = function(id) {
        $.getJSON("{% url api %}", {
                        'action': 'change-debit',
                        'id': id,
                        'debit': prompt("Nieuw debet")},
                        function(d) {
                if(d.success) window.location.reload();
                if(d.error) alert(d.error);
        });
};
</script>
{% endblock %}

{% block body %}
<h1>{{ object.humanName }}</h1>
<p>{{ object.description }}</p>
<dl>
        {% if object.date %}
        <dt>Datum</dt>
        <dd>{{ object.date.date }}</dd>
        {% endif %}{# object.date #}
	{% if object.owner %}
	<dt>Georganiseerd door</dt>
	<dd><a href="{{ object.owner.get_absolute_url }}"
		>{{ object.owner.humanName }}</a></dd>
	{% endif %}
	{% if object.cost %}
	<dt>Kosten</dt>
	<dd>&euro; {{ object.cost }}</dd>
	{% endif %}
</dl>

{% if object.is_open and has_write_access %}
<button onclick="close_event()">Sluit inschrijvingen</button>
{% endif %}{# object.is_open and has_write_access #}

{% if not subscription %}
{% if object.is_open %}
<form method="post" action="">
        <textarea class="default" name="notes"
                style="width: 200px; height: 70px;"
                title="Opmerkingen"></textarea><br/>
	<input type="submit" value="{{ user.full_name }} aanmelden!" /> 
	{% csrf_token %}
</form>
{% else %}{# object.is_open #}
<p><em>Je kunt je niet meer aanmelden.</em></p>
{% endif %}{# object.is_open #}
{% endif %}

{% if subscrlist %}
	<h2>Aanmeldingen ({{ subscrlist_count }})</h2>
{% if subscrcount_debit %}
	<p>Er staan nog {{ subscrcount_debit }} betalingen open.</p>
{% endif %}
	<ul>
	{% for subscr in subscrlist %}
	<li><a href="{{ subscr.user.get_absolute_url }}"
                >{{ subscr.user.full_name }}</a> (debet: &euro;
                {{ subscr.debit }}
                {% if has_debit_access %}
                <button onclick="change_debit('{{ subscr.id }}')"
                                >wijzig</button>
                {% endif %}{# has_debit_access #} 
                )</li>
                {% if subscr.userNotes %}
                <blockquote>{{ subscr.userNotes }}</blockquote>
                {% endif %}
	{% endfor %}
	</ul>
{% endif %}
{% endblock %}
